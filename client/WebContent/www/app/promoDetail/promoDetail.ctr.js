/// <reference path="../app.d.ts" />
var Tomedescontos;
(function (Tomedescontos) {
    var PromoDetailController = (function () {
        function PromoDetailController($scope, $http, $stateParams, $q, $translate, promoService) {
            var _this = this;
            this.$scope = $scope;
            this.$http = $http;
            this.$stateParams = $stateParams;
            this.$q = $q;
            this.$translate = $translate;
            this.promoService = promoService;
            /* Private variables come here. */
            this.promo = [];
            this.title = "";
            /* Saving promo title in a short variable. Im' lazy! ;D */
            this.title = this.$stateParams.title;
            this.promo["shareUrl"] = window.location.href;
            /* (1) retrieving promo data from our database. */
            this.promoService.findPromoByTitle(this.title).then(function (data) {
                _this.promo["url"] = data.url;
                _this.promo["img"] = data.img;
            });
            this.splittingPriceFromTitle(this.title);
            this.promoService.getPromoDetail(this.improvingTheTitle(this.title)).then(function (data) {
                /* If promo does not have an image set and we found one through buscape api, then
                   set it to image atribute and update it in the database. */
                if (!_this.promo["img"] && data.image) {
                    _this.promo["img"] = data.image;
                    /* I'm updating just the promo image at this moment, but I'll update all new data
                    regarding the promo later. */
                    _this.promoService.updatePromoData(_this.promo);
                }
                _this.promo["maxPrice"] = data.maxPrice;
                _this.promo["minPrice"] = data.minPrice;
            });
        }
        PromoDetailController.prototype.improvingTheTitle = function (title) {
            var result = [];
            /* all regex patterns we will use further */
            var rgx0 = new RegExp("\[.*?\]", "g");
            var rgx1 = new RegExp("(R\$ (\d{1,7}(\.\d{3})*|\d+)(\,\d{2})?)", "g");
            var rgx2 = new RegExp("(R\$(\d{1,7}(\.\d{3})*|\d+)(\,\d{2})?)", "g");
            var rgx3 = new RegExp("[0-9]+(,[0-9]+)", "g");
            var rgx4 = new RegExp("[/!,@#$%^&*'\"+=-]", "g");
            var rgx5 = new RegExp("\(|\)", "g");
            var rgx6 = new RegExp("\s\s+", "g");
            /* removing all texts between brackets */
            if (title.search(rgx0) != -1) {
                title = title.replace(rgx0, '');
            }
            /* removing price tags */
            if (title.search(rgx1) != -1) {
                title = title.replace(rgx1, '');
            }
            if (title.search(rgx2) != -1) {
                title = title.replace(rgx2, '');
            }
            /* removing decimal numbers */
            if (title.search(rgx3) != -1) {
                title = title.replace(rgx3, '');
            }
            /* removing special characters */
            if (title.search(rgx4) != -1) {
                title = title.replace(rgx4, '');
            }
            if (title.search(rgx5) != -1) {
                title = title.replace(rgx5, '');
            }
            /* replacing double whitespaces by single whitespace */
            if (title.search(rgx6) != -1) {
                title = title.replace(rgx6, ' ');
            }
            /* splitting the titleand put it into array */
            title = title.trim().split(" ");
            /* getting just 5 words at maximum from the title to compose the new title */
            for (var i = 0; i < 7; i++) {
                result.push(title[i]);
            }
            return result.join(' ');
        };
        PromoDetailController.prototype.splittingPriceFromTitle = function (txt) {
            var rgx10 = /(R\$ (\d{1,7}(\.\d{3})*|\d+)(\,\d{2})?)/g;
            var rgx11 = /(R\$(\d{1,7}(\.\d{3})*|\d+)(\,\d{2})?)/g;
            if (txt.search(rgx10) != -1) {
                this.promo["title"] = txt.replace(rgx10, '');
                this.promo["price"] = txt.match(rgx10)[0];
            }
            if (txt.search(rgx11) != -1) {
                this.promo["title"] = txt.replace(rgx11, '');
                this.promo["price"] = txt.match(rgx11)[0];
            }
        };
        return PromoDetailController;
    }());
    Tomedescontos.PromoDetailController = PromoDetailController;
})(Tomedescontos || (Tomedescontos = {}));
app.controller('PromoDetailController', ['$scope', '$http', '$stateParams', '$q', '$translate', 'PromoService', Tomedescontos.PromoDetailController]);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb21vRGV0YWlsL3Byb21vRGV0YWlsLmN0ci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxvQ0FBb0M7QUFFcEMsSUFBTyxhQUFhLENBcUduQjtBQXJHRCxXQUFPLGFBQWEsRUFBQyxDQUFDO0lBRWxCO1FBTUksK0JBQW9CLE1BQWlCLEVBQ3pCLEtBQXNCLEVBQ3RCLFlBQWlCLEVBQ2pCLEVBQWdCLEVBQ2hCLFVBQTBDLEVBQzFDLFlBQTBCO1lBWDFDLGlCQWtHQztZQTVGdUIsV0FBTSxHQUFOLE1BQU0sQ0FBVztZQUN6QixVQUFLLEdBQUwsS0FBSyxDQUFpQjtZQUN0QixpQkFBWSxHQUFaLFlBQVksQ0FBSztZQUNqQixPQUFFLEdBQUYsRUFBRSxDQUFjO1lBQ2hCLGVBQVUsR0FBVixVQUFVLENBQWdDO1lBQzFDLGlCQUFZLEdBQVosWUFBWSxDQUFjO1lBVHRDLGtDQUFrQztZQUMxQixVQUFLLEdBQVMsRUFBRSxDQUFDO1lBQ2pCLFVBQUssR0FBVyxFQUFFLENBQUM7WUFTbkIsMERBQTBEO1lBQzFELElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUM7WUFDckMsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztZQUU5QyxrREFBa0Q7WUFDbEQsSUFBSSxDQUFDLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsSUFBSTtnQkFDckQsS0FBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO2dCQUM3QixLQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7WUFDakMsQ0FBQyxDQUFDLENBQUE7WUFFRixJQUFJLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lB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QUssRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDN0MsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlDLENBQUM7WUFFRCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDekIsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDN0MsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlDLENBQUM7UUFDTCxDQUFDO1FBRUwsNEJBQUM7SUFBRCxDQWxHQSxBQWtHQyxJQUFBO0lBbEdZLG1DQUFxQix3QkFrR2pDLENBQUE7QUFDTCxDQUFDLEVBckdNLGFBQWEsS0FBYixhQUFhLFFBcUduQjtBQUNELEdBQUcsQ0FBQyxVQUFVLENBQUMsdUJBQXVCLEVBQUUsQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLGNBQWMsRUFBRSxhQUFhLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6InByb21vRGV0YWlsL3Byb21vRGV0YWlsLmN0ci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi9hcHAuZC50c1wiIC8+XG5cbm1vZHVsZSBUb21lZGVzY29udG9zIHtcblxuICAgIGV4cG9ydCBjbGFzcyBQcm9tb0RldGFpbENvbnRyb2xsZXIge1xuXG4gICAgICAgIC8qIFByaXZhdGUgdmFyaWFibGVzIGNvbWUgaGVyZS4gKi9cbiAgICAgICAgcHJpdmF0ZSBwcm9tbzogYW55W109IFtdO1xuICAgICAgICBwcml2YXRlIHRpdGxlOiBTdHJpbmcgPSBcIlwiO1xuICAgICAgICBcbiAgICAgICAgY29uc3RydWN0b3IocHJpdmF0ZSAkc2NvcGU6IG5nLklTY29wZSwgXG4gICAgICAgICAgICBwcml2YXRlICRodHRwOiBuZy5JSHR0cFNlcnZpY2UsXG4gICAgICAgICAgICBwcml2YXRlICRzdGF0ZVBhcmFtczogYW55LCBcbiAgICAgICAgICAgIHByaXZhdGUgJHE6IG5nLklRU2VydmljZSwgXG4gICAgICAgICAgICBwcml2YXRlICR0cmFuc2xhdGU6IG5nLnRyYW5zbGF0ZS5JVHJhbnNsYXRlU2VydmljZSxcbiAgICAgICAgICAgIHByaXZhdGUgcHJvbW9TZXJ2aWNlOiBQcm9tb1NlcnZpY2UpIHsgICBcblxuICAgICAgICAgICAgICAgIC8qIFNhdmluZyBwcm9tbyB0aXRsZSBpbiBhIHNob3J0IHZhcmlhYmxlLiBJbScgbGF6eSEgO0QgKi8gICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB0aGlzLnRpdGxlID0gdGhpcy4kc3RhdGVQYXJhbXMudGl0bGU7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9tb1tcInNoYXJlVXJsXCJdID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG5cbiAgICAgICAgICAgICAgICAvKiAoMSkgcmV0cmlldmluZyBwcm9tbyBkYXRhIGZyb20gb3VyIGRhdGFiYXNlLiAqL1xuICAgICAgICAgICAgICAgIHRoaXMucHJvbW9TZXJ2aWNlLmZpbmRQcm9tb0J5VGl0bGUodGhpcy50aXRsZSkudGhlbigoZGF0YSk9PntcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9tb1tcInVybFwiXSA9IGRhdGEudXJsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb21vW1wiaW1nXCJdID0gZGF0YS5pbWc7XG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIHRoaXMuc3BsaXR0aW5nUHJpY2VGcm9tVGl0bGUodGhpcy50aXRsZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9tb1NlcnZpY2UuZ2V0UHJvbW9EZXRhaWwodGhpcy5pbXByb3ZpbmdUaGVUaXRsZSh0aGlzLnRpdGxlKSkudGhlbigoZGF0YSk9PntcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8qIElmIHByb21vIGRvZXMgbm90IGhhdmUgYW4gaW1hZ2Ugc2V0IGFuZCB3ZSBmb3VuZCBvbmUgdGhyb3VnaCBidXNjYXBlIGFwaSwgdGhlblxuICAgICAgICAgICAgICAgICAgICAgICBzZXQgaXQgdG8gaW1hZ2UgYXRyaWJ1dGUgYW5kIHVwZGF0ZSBpdCBpbiB0aGUgZGF0YWJhc2UuICovXG4gICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnByb21vW1wiaW1nXCJdICYmIGRhdGEuaW1hZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJvbW9bXCJpbWdcIl0gPSBkYXRhLmltYWdlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvKiBJJ20gdXBkYXRpbmcganVzdCB0aGUgcHJvbW8gaW1hZ2UgYXQgdGhpcyBtb21lbnQsIGJ1dCBJJ2xsIHVwZGF0ZSBhbGwgbmV3IGRhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2FyZGluZyB0aGUgcHJvbW8gbGF0ZXIuICovXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByb21vU2VydmljZS51cGRhdGVQcm9tb0RhdGEodGhpcy5wcm9tbyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb21vW1wibWF4UHJpY2VcIl0gPSBkYXRhLm1heFByaWNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb21vW1wibWluUHJpY2VcIl0gPSBkYXRhLm1pblByaWNlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcHVibGljIGltcHJvdmluZ1RoZVRpdGxlKHRpdGxlOiBhbnkpOiBTdHJpbmcge1xuXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgICAgICAgICAvKiBhbGwgcmVnZXggcGF0dGVybnMgd2Ugd2lsbCB1c2UgZnVydGhlciAqL1xuICAgICAgICAgICAgdmFyIHJneDAgPSBuZXcgUmVnRXhwKFwiXFxbLio/XFxdXCIsIFwiZ1wiKTtcbiAgICAgICAgICAgIHZhciByZ3gxID0gbmV3IFJlZ0V4cChcIihSXFwkIChcXGR7MSw3fShcXC5cXGR7M30pKnxcXGQrKShcXCxcXGR7Mn0pPylcIiwgXCJnXCIpO1xuICAgICAgICAgICAgdmFyIHJneDIgPSBuZXcgUmVnRXhwKFwiKFJcXCQoXFxkezEsN30oXFwuXFxkezN9KSp8XFxkKykoXFwsXFxkezJ9KT8pXCIsIFwiZ1wiKTtcbiAgICAgICAgICAgIHZhciByZ3gzID0gbmV3IFJlZ0V4cChcIlswLTldKygsWzAtOV0rKVwiLCBcImdcIik7XG4gICAgICAgICAgICB2YXIgcmd4NCA9IG5ldyBSZWdFeHAoXCJbLyEsQCMkJV4mKidcXFwiKz0tXVwiLCBcImdcIik7XG4gICAgICAgICAgICB2YXIgcmd4NSA9IG5ldyBSZWdFeHAoXCJcXCh8XFwpXCIsIFwiZ1wiKTtcbiAgICAgICAgICAgIHZhciByZ3g2ID0gbmV3IFJlZ0V4cChcIlxcc1xccytcIiwgXCJnXCIpO1xuXG4gICAgICAgICAgICAvKiByZW1vdmluZyBhbGwgdGV4dHMgYmV0d2VlbiBicmFja2V0cyAqL1xuICAgICAgICAgICAgaWYodGl0bGUuc2VhcmNoKHJneDApICE9IC0xKSB7IHRpdGxlID0gdGl0bGUucmVwbGFjZShyZ3gwLCAnJyk7IH1cblxuICAgICAgICAgICAgLyogcmVtb3ZpbmcgcHJpY2UgdGFncyAqL1xuICAgICAgICAgICAgaWYodGl0bGUuc2VhcmNoKHJneDEpICE9IC0xKSB7IHRpdGxlID0gdGl0bGUucmVwbGFjZShyZ3gxLCAnJyk7IH1cbiAgICAgICAgICAgIGlmKHRpdGxlLnNlYXJjaChyZ3gyKSAhPSAtMSkgeyB0aXRsZSA9IHRpdGxlLnJlcGxhY2Uocmd4MiwgJycpOyB9XG5cbiAgICAgICAgICAgIC8qIHJlbW92aW5nIGRlY2ltYWwgbnVtYmVycyAqL1xuICAgICAgICAgICAgaWYodGl0bGUuc2VhcmNoKHJneDMpICE9IC0xKSB7IHRpdGxlID0gdGl0bGUucmVwbGFjZShyZ3gzLCAnJyk7IH1cblxuICAgICAgICAgICAgLyogcmVtb3Zpbmcgc3BlY2lhbCBjaGFyYWN0ZXJzICovXG4gICAgICAgICAgICBpZih0aXRsZS5zZWFyY2gocmd4NCkgIT0gLTEpIHsgdGl0bGUgPSB0aXRsZS5yZXBsYWNlKHJneDQsICcnKTsgfVxuICAgICAgICAgICAgaWYodGl0bGUuc2VhcmNoKHJneDUpICE9IC0xKSB7IHRpdGxlID0gdGl0bGUucmVwbGFjZShyZ3g1LCAnJyk7IH1cblxuICAgICAgICAgICAgLyogcmVwbGFjaW5nIGRvdWJsZSB3aGl0ZXNwYWNlcyBieSBzaW5nbGUgd2hpdGVzcGFjZSAqL1xuICAgICAgICAgICAgaWYodGl0bGUuc2VhcmNoKHJneDYpICE9IC0xKSB7IHRpdGxlID0gdGl0bGUucmVwbGFjZShyZ3g2LCAnICcpOyB9XG5cbiAgICAgICAgICAgIC8qIHNwbGl0dGluZyB0aGUgdGl0bGVhbmQgcHV0IGl0IGludG8gYXJyYXkgKi9cbiAgICAgICAgICAgIHRpdGxlID0gdGl0bGUudHJpbSgpLnNwbGl0KFwiIFwiKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLyogZ2V0dGluZyBqdXN0IDUgd29yZHMgYXQgbWF4aW11bSBmcm9tIHRoZSB0aXRsZSB0byBjb21wb3NlIHRoZSBuZXcgdGl0bGUgKi9cbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCA3OyBpKyspe1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRpdGxlW2ldKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5qb2luKCcgJyk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHB1YmxpYyBzcGxpdHRpbmdQcmljZUZyb21UaXRsZSh0eHQ6IFN0cmluZyk6IHZvaWR7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciByZ3gxMCA9IC8oUlxcJCAoXFxkezEsN30oXFwuXFxkezN9KSp8XFxkKykoXFwsXFxkezJ9KT8pL2c7XG4gICAgICAgICAgICB2YXIgcmd4MTEgPSAvKFJcXCQoXFxkezEsN30oXFwuXFxkezN9KSp8XFxkKykoXFwsXFxkezJ9KT8pL2c7XG5cbiAgICAgICAgICAgIGlmKHR4dC5zZWFyY2gocmd4MTApICE9IC0xKSB7IFxuICAgICAgICAgICAgICAgIHRoaXMucHJvbW9bXCJ0aXRsZVwiXSA9IHR4dC5yZXBsYWNlKHJneDEwLCAnJyk7IFxuICAgICAgICAgICAgICAgIHRoaXMucHJvbW9bXCJwcmljZVwiXSA9IHR4dC5tYXRjaChyZ3gxMClbMF07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKHR4dC5zZWFyY2gocmd4MTEpICE9IC0xKSB7IFxuICAgICAgICAgICAgICAgIHRoaXMucHJvbW9bXCJ0aXRsZVwiXSA9IHR4dC5yZXBsYWNlKHJneDExLCAnJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9tb1tcInByaWNlXCJdID0gdHh0Lm1hdGNoKHJneDExKVswXTsgXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH1cbn1cbmFwcC5jb250cm9sbGVyKCdQcm9tb0RldGFpbENvbnRyb2xsZXInLCBbJyRzY29wZScsICckaHR0cCcsICckc3RhdGVQYXJhbXMnLCAnJHEnLCAnJHRyYW5zbGF0ZScsICdQcm9tb1NlcnZpY2UnLCBUb21lZGVzY29udG9zLlByb21vRGV0YWlsQ29udHJvbGxlcl0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
